<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>  使用xlsx 实现纯前端的上传excel，并解析显示 | Zhai Yingying&#39;s Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Zhai Yingying's Blog">
    <meta name="author" content="Zhai Yingying">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Zhai Yingying&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/hexo/" class="animsition-link">hexo<small>(0)</small></a></li>
				    
				</ul>
        	</li>
			
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/" class="animsition-link" title="about">About</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.PNG" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Zhai Yingying's Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2016-10-27T05:15:28.000Z" itemprop="datePublished">
          2016-10-27
      </time>
    
</span>
                <h1>  使用xlsx 实现纯前端的上传excel，并解析显示</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>传统意义上的，如果我们需要上传excel文件后显示到前端页面，需要我们上传给后台，然后后台进行数据解析，再把数据返回给前端，前端在页面显示内容。这无疑很浪费时间，本次尝试使用xlsx.js进行上传，前端可以自己进行数据解析。<br>项目展示: <a href="https://zhaiyy.github.io/js-xlsx_upload_excel/" target="_blank" rel="external">https://zhaiyy.github.io/js-xlsx_upload_excel/</a></p>
<p>我们可以看到官网文档中，提供了一下几个方式的例子</p>
<ol>
<li>node readFile</li>
<li>ajax (for a more complete example that works in older browsers, check the demo at <a href="http://oss.sheetjs.com/js-xlsx/ajax.html" target="_blank" rel="external">http://oss.sheetjs.com/js-xlsx/ajax.html</a>)</li>
<li>HTML5 drag-and-drop using readAsBinaryString</li>
<li><p>HTML5 input file element using readAsBinaryString</p>
<pre><code>function handleFile (e) {
     var files = e.target.files;
     var i, f;
     for (i = 0, f = files[i]; i != files.length; ++i) {
         var reader = new FileReader();
         var name = f.name;
         reader.onload = function(e) {
             var data = e.target.result;
             var workbook = XLSX.read(data, {type: &apos;binary&apos;});
             /* DO SOMETHING WITH workbook HERE */
         };
         reader.readAsBinaryString(f);
     }
 }
 input_dom_element.addEventListener(&apos;change&apos;, handleFile, false);
</code></pre></li>
</ol>
<p>根据以上例子，我们可以继续进行</p>
<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><pre><code>&lt;input type=&quot;file&quot; accept=&quot; application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot; id=&quot;upload_excel&quot;/&gt;
&lt;div id=&quot;content&quot;&gt;&lt;/div&gt;//用于展示上传的excel数据
    function handleFile(e) {
        var files = e.target.files;
        var i,f;
        for (i = 0, f = files[i]; i != files.length; ++i) {
            var reader = new FileReader();
            var name = f.name;
            reader.onload = function(e) {
                var data = e.target.result;
               var workbook = XLSX.read(data, {type: &apos;binary&apos;});
                /* 进行数据解析
                ..............
                */
            };
            reader.readAsBinaryString(f);
        }
    }
    $(&apos;\#upload\_excel&apos;).bind(&apos;change&apos;, handleFile);
</code></pre><p>workbook,包含我们上传excel中各个工作表的信息，我们可以使用workbook.SheetNames获取工作簿中的一个有序列表，获取当前excel有数据的工作表中的数据。</p>
<pre><code>var result = [];
var dataFormulae = [];
sheet_name_list.forEach(function(y) {
    var worksheet = workbook.Sheets[y];
    var json = XLSX.utils.sheet_to_json(workbook.Sheets[y]);
    var formulae = XLSX.utils.sheet_to_formulae(workbook.Sheets[y]);
    if(json.length &gt; 0){
        result = json;
        dataFormulae = formulae;
    }
});
</code></pre><ul>
<li><code>sheet_to_json</code> 每行以json数组形式输出。形式：[[head:value,head:value,…],[head:value,head:value,…],…]但是有一个缺点，就是在excel表格中当头部所对应的value值为空的时候，默认不输出。所以我们不确保每一行获取的数据的是不是包含完整的head信息</li>
<li><code>sheet_to_csv</code> 每行以逗号为分隔符输出。形式：head,head,…\n value,value.. \n value,value….。看起来这个好像是最完美的方式，我们获取数据可以以逗号分隔获取，但是如果当前输入的内容中包含逗号，进行分割的时候就会出现问题。所以抛弃了这种方式</li>
<li><code>sheet_to_formulae</code> 生成一个公式列表，即A1:value,B1:value,C1:value…A2:value,B2:value,C2:value…A3:value,B3:vlaue,C3:value…虽然展示数据大材小用，但是我们可以获取到所有的完整头部信息</li>
</ul>
<p>接下来我们解析表格头部数据，以及data部分的数据</p>
<pre><code>var headItem = [];
var dataItem = [];
$.each(dataFormulae, function (j, head) {
    var headlist = head.split(&quot;=&apos;&quot;)
    if (/^[A-Z]1$/.test(headlist[0])) {
        headItem.push(headlist[1]);
    }
})
$.each(result, function (i, val) {
    var data = [];
    $.each(headItem, function (k, head) {
        val[head] != undefined ? data.push(val[head]) : data.push(&quot;&quot;);
    });
    dataItem.push(data);
});
</code></pre><p>更新于2016/11/10</p>
<p>由于之前的代码存在，当表头为空时，会出现内容错位的bug，所以进行了以下的更改，但以下的方法并不是自己觉得很完美的方式，更好的方式还得进一步探索。特此保留之前的思路。</p>
<pre><code>$.each(dataCsv, function (j, head) {
   var headlist = head.split(&quot;=&apos;&quot;);
   rowNum = /^[A-Z]+(\d+)$/.exec(headlist[0])[1];
   headCode.indexOf(/^([A-Z]+)\d+$/.exec(headlist[0])[1]) == -1 ? headCode.push(/^([A-Z]+)\d+$/.exec(headlist[0])[1]) : &apos;&apos;;
});
headCode = headCode.sort();
$.each(headCode, function (i, val) {
   headItem[val] = &apos;&apos;;
});
for(var i = 0; i &lt; Number(rowNum)-1; i++) {
   var obj = {};
   $.each(headCode, function (i, val) {
      obj[val] = &apos;&apos;;
   });
   dataItem[i] = obj;
};
$.each(dataCsv, function (j, head) {
   var headlist = head.split(&quot;=&apos;&quot;);
   var code = /^([A-Z]+)\d+$/.exec(headlist[0])[1];
   var row = /^[A-Z]+(\d+)$/.exec(headlist[0])[1];
   if (row == 1) {
      headItem[code] = headlist[1];
   } else {
      dataItem[row-2][code] = headlist[1];
   };
});
</code></pre><p>最后把数据拼接成table字符串，复制到容器中</p>
<pre><code>var headstr = &apos;&apos;;
var datastr = &apos;&apos;;
$.each(headItem, function (i, head) {
    headstr = headstr + &apos;&lt;th style=&quot;border: 1px solid #cccccc&quot;&gt;&apos; + head + &apos;&lt;/th&gt;&apos; });
$.each(dataItem, function (i, data) {
    datastr = datastr + &apos;&lt;tr &gt;&apos;;
    $.each(data, function (j, val) {
        datastr = datastr + &apos;&lt;td style=&quot;border: 1px solid #cccccc&quot;&gt;&apos;+val+&apos;&lt;/td&gt;&apos;;
     });
    datastr = datastr + &apos;&lt;/tr&gt;&apos;;
});
var table =
&apos;&lt;table style=&quot;border: 1px solid #cccccc;border-collapse:collapse;&quot;&gt;&apos;+
   &apos;&lt;thead&gt;&apos;+
     &apos;&lt;tr style=&quot;font-weight:bold&quot;&gt;&apos;+
     headstr +
     &apos;&lt;/tr&gt;&apos;+
  &apos;&lt;/thead&gt;&apos;+
  &apos;&lt;tbody&gt;&apos;+
     datastr+
  &apos;&lt;/tbody&gt;&apos;+
&apos;&lt;/table&gt;&apos;;
$(&apos;#content&apos;).html( $(&apos;#content&apos;).html() + table);
</code></pre><p>这个整个上传excel并且展示到页面就完成了，小菜鸟一枚有不完美的地方还请大家指出，共同交流哇</p>
<p>项目展示: <a href="https://zhaiyy.github.io/js-xlsx_upload_excel/" target="_blank" rel="external">https://zhaiyy.github.io/js-xlsx_upload_excel/</a><br>完整项目地址：<a href="https://github.com/zhaiyy/js-xlsx_upload_excel" target="_blank" rel="external">https://github.com/zhaiyy/js-xlsx_upload_excel</a></p>
<p>xslx.js :<a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="external">https://github.com/SheetJS/js-xlsx</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/12/27/质因数分解法、短除法、辗转相除法、更相减损法求最大公约数/" style="float: left;">
        ←  质因数分解法、短除法、辗转相除法、更相减损法求最大公约数
    </a>
    
    
    <a class="pull-right" href="/2016/05/27/Effective-Javascript-阅读笔记（3）-闭包/">
         Effective Javascript 阅读笔记（3）-闭包 →
    </a>
    
</nav>

        <div class="duoshuo">
<div class="ds-thread" data-thread-key="2016/10/27/使用xlsx 实现纯前端的上传excel，并解析显示 /" data-title="  使用xlsx 实现纯前端的上传excel，并解析显示" data-url="http://yoursite.com/2016/10/27/使用xlsx 实现纯前端的上传excel，并解析显示 /"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"zhaiyy"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Zhai Yingying. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
